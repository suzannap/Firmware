#!nsh
#
# @name WaterBee
#
# @type Tait custom
#
# @maintainer Suzanna Paulos <spaulos@taittowers.com>
#

#start required apps:
ekf2 start
pozyx start

if [ $AUTOCNF == yes ]
then
	param set PWM_DISARMED 0
	param set PWM_MIN 1000
	param set PWM_MAX 2000
	param set PWM_RATE 400

	param set COM_RC_IN_MODE 1

	param set ATT_EXT_HDG_M 2
	param set SYS_MC_EST_GROUP 2

	#enable mocap data for positoin and yaw
	param set EKF_AID_MASK 24

	#position of Pixhawk in frame
	param set EKF2_IMU_POS_X 0
	param set EKF2_IMU_POS_Y 0
	param set EKF2_IMU_POS_Z 0

	#position of Pozyx in frame
	param set EKF2_EV_POS_X 0
	param set EKF2_EV_POS_Y 0
	param set EKF2_EV_POS_Z 0

	#set the offboard control switch to an unused channel, and give it a thresholed so it's always on
	param set RC_MAP_OFFB_SW 18
	param set RC_OFFB_TH -1

fi


# tell the mixer to use parameters for these instead
set PWM_RATE p:PWM_RATE
set PWM_DISARMED p:PWM_DISARMED
set PWM_MIN p:PWM_MIN
set PWM_MAX p:PWM_MAX

# This is the gimbal pass mixer
set MIXER_AUX pass
set PWM_AUX_RATE 50
set PWM_AUX_OUT 1234
set PWM_AUX_DISARMED 1500
set PWM_AUX_MIN 1000
set PWM_AUX_MAX 2000

if param compare PWM_DISARMED 0
then
	param set PWM_DISARMED 900
fi


#set mixer
set MIXER waterbee

#this needs to happen later -- called where extras.txt would be called in rcS
#non-standard MAVLink messages
#mavlink stream -r 5 -s ATT_POS_MOCAP -d /dev/ttyS1
